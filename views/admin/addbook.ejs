<!DOCTYPE html>
<html>

<head>
    <title>Add Book</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="/public/css/addbook.css">
</head>

<body>
    <%- include('../admin/adminHeader')%>
        <div class="container">
            <div class="m-5">
                <div class="row">
                    <a href="/admin/productlist" style="color: white ; margin-top: 1rem;">Back</a>
                    <div class="col-md-6 offset-md-3">
                        <form class="signup-form" action="/admin/addbook" method="post" enctype="multipart/form-data">
                            <h2>Add Book</h2>

                            <div class="form-group">
                                <label for="name">Name of Book</label>
                                <input type="text" class="form-control" id="name" name="name" >
                                <a id="name-error" style="color: red; font-size: small;"></a>
                            </div>

                            <div class="form-group">
                                <label for="aname">Author</label>
                                <input type="text" class="form-control" id="aname" name="author" >
                                <a id="author-error" style="color: red; font-size: small;"></a>
                            </div>

                            <div class="form-group">
                                <label for="page">Pages</label>
                                <input type="text" class="form-control" id="page" name="pages" >
                                <a id="page-error" style="color: red; font-size: small;"></a>
                            </div>
                            <div class="form-group">
                                <label for="category">Category</label>
                                <select class="form-control" id="category" name="category">
                                    <% if (category.length> 0) {
                                        for(let i=0; i<category.length; i++) { %>
                                            <option>
                                                <%= category[i].name %>
                                            </option>
                                            <% } } %>
                                </select>
                                <a id="cat-error" style="color: red; font-size: small;"></a>
                            </div>
                            <div class="form-group">
                                <label for="lang">Language</label>
                                <select class="form-control" id="lang" name="language">
                                    <option>
                                        Malayalam
                                    </option>
                                    <option>
                                        English
                                    </option>

                                </select>
                                <a id="lang-error" style="color: red; font-size: small;"></a>
                            </div>
                            <div class="form-group">
                                <label for="desc">Description</label>
                                <input type="text" class="form-control" id="desc" name="description" >
                                <a id="desc-error" style="color: red; font-size: small;"></a>
                            </div>
                            <div class="form-group">
                                <label for="pr">Price</label>
                                <input type="text" class="form-control" id="price" name="price" >
                                <a id="price-error" style="color: red; font-size: small;"></a>
                            </div>
                            <div class="form-group">
                                <label for="stk">Stock</label>
                                <input type="text" class="form-control" id="stock" name="stock" >
                                <a id="stock-error" style="color: red; font-size: small;"></a>
                            </div>
                            <div class="form-group">
                                <label for="cover">Cover page</label>
                                <input type="file" class="form-control-file custom-file-input" id="cover" name="image"
                                    onchange="previewImage(event)" multiple>
                                <a id="cover-error" style="color: red; font-size: small;"></a>
                                <div>
                                    <img id="image-preview" class="image-preview"
                                        style="width:75px;height:75px ;border:none; ">
                                </div>

                                <button type="submit" class="btn btn-block" id="addbook">Add
                                    Book</button>
                                <% if(typeof message !=='undefined' ) {%>
                                    <p style="color: rgb(255, 0, 0); font-weight: bold;">
                                        <%=message%>
                                    </p>
                                    <%} %>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            function previewImage(event) {
                var reader = new FileReader();
                reader.onload = function () {
                    var imagePreview = document.getElementById('image-preview');
                    imagePreview.src = reader.result;
                }
                for(let i=0;i<target.files.length;i++){
                    
                }
                reader.readAsDataURL(event.target.files[0]);
            }
        </script>
        <script>
            const bname = document.getElementById('name')
            const aname = document.getElementById('aname')
            const page = document.getElementById('page')
            const category = document.getElementById('category')
            const lang = document.getElementById('lang')
            const desc = document.getElementById('desc')
            const price = document.getElementById('price')
            const stock = document.getElementById('stock')
            const cover = document.getElementById('cover')
         
            const covererror = document.getElementById('cover-error')
            const nameerror = document.getElementById('name-error')
            const anameerror = document.getElementById('author-error')
            const pageerror = document.getElementById('page-error')
            const caterror = document.getElementById('cat-error')
            const langerror = document.getElementById('lang-error')
            const descerror = document.getElementById('desc-error')
            const priceerror = document.getElementById('price-error')
            const stockerror = document.getElementById('stock-error')


            // Function to validate first name
            function validateName() {
                let name_message = []

                if (bname.value === '' || bname.value === null) {
                    name_message.push('Book name is Mandatory!')
                }
                if (name_message.length > 0) {
                    nameerror.innerText = name_message.join(',')
                } else {
                    nameerror.innerText = ''
                }
            }

            // Function to validate username
            function validateAuthorname() {
                let aname_message = []
                if (aname.value === '' || aname.value === null || aname.value.length < 3) {
                    aname_message.push('Minimum length of author name required is 3')
                }
                if (aname_message.length > 0) {
                    anameerror.innerText = aname_message.join(',')
                } else {
                    anameerror.innerText = ''
                }
            }

            function validatePage() {
                let page_message = []
                let pageVal = page.value
                if (page.value === '' || page.value === null) {
                    page_message.push('Page number is mandatory')
                } else if (isNaN(pageVal)) {
                    page_message.push('Page number should be a number')
                }
                if (page_message.length > 0) {
                    pageerror.innerText = page_message.join(',')
                } else {
                    pageerror.innerText = ''
                }
            }

            function validateDesc() {
                let desc_message = []
                if (desc.value === '' || desc.value === null) {
                    desc_message.push('Description is mandatory')
                } else if (desc.value.length < 10) {
                    desc_message.push('Description should be minimum 10 words')
                }
                if (desc_message.length > 0) {
                    descerror.innerText = desc_message.join(',')
                } else {
                    descerror.innerText = ''
                }
            }

            function validatePrice() {
                let price_message = []
                if (price.value === '' || price.value === null) {
                    price_message.push('Price is mandatory')
                } else if (isNaN(price.value)) {
                    price_message.push('Price should be a number')
                }
                if (price_message.length > 0) {
                    priceerror.innerText = price_message.join(',')
                } else {
                    priceerror.innerText = ''
                }
            }

            function validateStock() {
                let stock_message = []
                if (stock.value === '' || stock.value === null) {
                    stock_message.push('Stock is mandatory')
                } else if (isNaN(stock.value)) {
                    stock_message.push('Stock should be a number')
                }
                if (stock_message.length > 0) {
                    stockerror.innerText = stock_message.join(',')
                } else {
                    stockerror.innerText = ''
                }
            }

            function validateCover() {
                const allowedExtensions = ['jpg', 'jpeg', 'png'];
                const file_message = [];

                if (cover.value === '' || cover.value === null) {
                    file_message.push('Image is required');
                } else {
                    const fileName = cover.value;
                    const fileExtension = fileName.split('.').pop().toLowerCase();

                    if (!allowedExtensions.includes(fileExtension)) {
                        file_message.push('Invalid file type. Only JPG and JPEG and PNG files are allowed');
                    }
                }

                if (file_message.length > 0) {
                    covererror.innerText = file_message.join(', ');
                } else {
                    covererror.innerText = '';
                }
            }
            // Add keyup event listeners to the form fields
            bname.addEventListener('keyup', validateName);
            aname.addEventListener('keyup', validateAuthorname);
            page.addEventListener('keyup', validatePage);
            desc.addEventListener('keyup', validateDesc);
            price.addEventListener('keyup', validatePrice);
            stock.addEventListener('keyup', validateStock);
            cover.addEventListener('keyup', validateCover);


            function handleSubmit(event) {
                // Prevent the form from submitting
        
                // Call the validation functions
                validateName();
                validateAuthorname();
                validatePage();
                validateDesc();
                validatePrice();
                validateStock();
                validateCover();


                // Check if any errors exist
                if (
                    nameerror.innerText === '' &&
                    anameerror.innerText === '' &&
                    pageerror.innerText === '' &&
                    descerror.innerText === '' &&
                    priceerror.innerText === '' &&
                    stockerror.innerText === '' &&
                    covererror.innerText === ''
                ) {
                    // All validations passed, allow form submission
                    event.target.submit();
                    function3()
                } else {
                    event.preventDefault();
                }
            }

            // Add submit event listener to the form
            const form = document.querySelector('form');
            form.addEventListener('submit', handleSubmit);
        </script>

        <script language="JavaScript">
            function function3() {
                Swal.fire({
                    title: 'Success!',
                    text: 'Book added successfully!',
                    icon: 'success',
                    showConfirmButton: false, // Hide the "OK" button
                });
            }
        </script>
</body>

</html>